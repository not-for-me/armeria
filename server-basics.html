

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Server basics &mdash; Armeria 0.21.2.Final documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="stylesheet" href="_static/overrides.css" type="text/css" />
  
    <link rel="top" title="Armeria 0.21.2.Final documentation" href="index.html"/>
        <link rel="up" title="Writing a server" href="server.html"/>
        <link rel="next" title="Serving static files" href="server-http-file.html"/>
        <link rel="prev" title="Writing a server" href="server.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html">
          

          
            
            <img src="_static/armeria.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                0.21
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="setup.html">Setting up a project</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="server.html">Writing a server</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Server basics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#bootstraping-an-armeria-server">Bootstraping an Armeria server</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-a-documentation-service">Adding a documentation service</a></li>
<li class="toctree-l3"><a class="reference internal" href="#next-steps">Next steps</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="server-http-file.html">Serving static files</a></li>
<li class="toctree-l2"><a class="reference internal" href="server-http-tomcat.html">Embedding Apache Tomcat</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="client.html">Writing a client</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/line/armeria/releases">Release notes</a></li>
<li class="toctree-l1"><a class="reference external" href="apidocs/index.html#://">API documentation</a></li>
<li class="toctree-l1"><a class="reference external" href="xref/index.html#://">Source cross-reference</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/line/armeria">Fork me at GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/line/armeria/blob/master/CONTRIBUTING.md">Contributing</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Armeria</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
        <li><a href="server.html">Writing a server</a> &raquo;</li>
      
    <li>Server basics</li>
    <li class="wy-breadcrumbs-aside">
      
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="server-basics">
<h1>Server basics<a class="headerlink" href="#server-basics" title="Permalink to this headline">¶</a></h1>
<p>Let&#8217;s assume we have the following Thrift IDL:</p>
<div class="highlight-thrift"><div class="highlight"><pre><span></span><span class="kn">namespace</span><span class="w"> </span><span class="nn">java</span><span class="w"> </span><span class="n">com.example.thrift</span><span class="w"></span>

<span class="kd">service</span><span class="w"> </span><span class="nc">HelloService</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">string</span><span class="w"> </span><span class="nf">hello</span><span class="o">(</span><span class="mi">1</span><span class="p">:</span><span class="kt">string</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The Apache Thrift compiler will produce some Java code under the <code class="docutils literal"><span class="pre">com.example.thrift</span></code> package. The most
noteworthy one is <code class="docutils literal"><span class="pre">HelloService.java</span></code> which defines the service interfaces we will implement:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloService</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Iface</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">hello</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">TException</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">interface</span> <span class="nc">AsyncIface</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">hello</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">AsyncMethodCallback</span> <span class="n">resultHandler</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">TException</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="o">...</span>
<span class="o">}</span>
</pre></div>
</div>
<p>If you are interested in going fully asynchronous, it is recommended to implement the <code class="docutils literal"><span class="pre">AsyncIface</span></code> interface,
while it is slightly easier to implement the synchronous <code class="docutils literal"><span class="pre">Iface</span></code> interface:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyHelloService</span> <span class="kd">implements</span> <span class="n">HelloService</span><span class="o">.</span><span class="na">AsyncIface</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">hello</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">AsyncMethodCallback</span> <span class="n">resultHandler</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">TException</span> <span class="o">{</span>
        <span class="n">resultHandler</span><span class="o">.</span><span class="na">onComplete</span><span class="o">(</span><span class="s">&quot;Hello, &quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="sc">&#39;!&#39;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// or synchronously:</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyHelloService</span> <span class="kd">implements</span> <span class="n">HelloService</span><span class="o">.</span><span class="na">Iface</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">hello</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">TException</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&quot;Hello, &quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="sc">&#39;!&#39;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="section" id="bootstraping-an-armeria-server">
<h2>Bootstraping an Armeria server<a class="headerlink" href="#bootstraping-an-armeria-server" title="Permalink to this headline">¶</a></h2>
<p>You can configure an Armeria server using the fluent builder pattern, as shown below:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">HelloService</span><span class="o">.</span><span class="na">AsyncIface</span> <span class="n">helloHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyHelloService</span><span class="o">();</span>

<span class="n">ServerBuilder</span> <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServerBuilder</span><span class="o">();</span>
<span class="n">sb</span><span class="o">.</span><span class="na">port</span><span class="o">(</span><span class="mi">8080</span><span class="o">,</span> <span class="n">SessionProtocol</span><span class="o">.</span><span class="na">HTTP</span><span class="o">);</span>
<span class="n">sb</span><span class="o">.</span><span class="na">serviceAt</span><span class="o">(</span>
        <span class="s">&quot;/hello&quot;</span><span class="o">,</span>
        <span class="n">ThriftService</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">helloHandler</span><span class="o">,</span> <span class="n">SerializationFormat</span><span class="o">.</span><span class="na">THRIFT_BINARY</span><span class="o">)</span>
                <span class="o">.</span><span class="na">decorate</span><span class="o">(</span><span class="n">LoggingService</span><span class="o">::</span><span class="k">new</span><span class="o">)).</span><span class="na">build</span><span class="o">();</span>

<span class="n">Server</span> <span class="n">server</span> <span class="o">=</span> <span class="n">sb</span><span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="n">server</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
</pre></div>
</div>
<p>In the example above, we created a new <code class="docutils literal"><span class="pre">ServerBuilder</span></code> and added a new <code class="docutils literal"><span class="pre">ThriftService</span></code> to it.
The <code class="docutils literal"><span class="pre">ThriftService</span></code> is bound at the path <code class="docutils literal"><span class="pre">/hello</span></code> and will use the TBinary format.</p>
<p>We also decorated the <code class="docutils literal"><span class="pre">ThriftService</span></code> using <code class="docutils literal"><span class="pre">LoggingService</span></code>, which logs all Thrift calls and replies.
You might be interested in decorating a service using other decorators, to gather metrics for example.</p>
<p>Note that you can add more than one <code class="docutils literal"><span class="pre">ThriftService</span></code> (or any <code class="docutils literal"><span class="pre">Service</span></code> implementation) to a <code class="docutils literal"><span class="pre">Server</span></code>.</p>
</div>
<div class="section" id="adding-a-documentation-service">
<h2>Adding a documentation service<a class="headerlink" href="#adding-a-documentation-service" title="Permalink to this headline">¶</a></h2>
<p>As usual, we could browse a Thrift IDL in a text editor to see the list of the available structs and
services. However, most of us will admit that it will be much nicer if we could browse such information
like we do for RESTful services via <a class="reference external" href="http://petstore.swagger.io/">Swagger</a>.</p>
<p>Armeria provides a service called <code class="docutils literal"><span class="pre">DocService</span></code>, which discovers all <code class="docutils literal"><span class="pre">ThriftService</span></code> in your Armeria server
and lets you browse the available service operations and structs:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">ServerBuilder</span> <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServerBuilder</span><span class="o">();</span>
<span class="n">sb</span><span class="o">.</span><span class="na">serviceAt</span><span class="o">(</span><span class="s">&quot;/foo/&quot;</span><span class="o">,</span> <span class="n">ThriftService</span><span class="o">.</span><span class="na">of</span><span class="o">(...))</span>
  <span class="o">.</span><span class="na">serviceAt</span><span class="o">(</span><span class="s">&quot;/bar/&quot;</span><span class="o">,</span> <span class="n">ThriftService</span><span class="o">.</span><span class="na">of</span><span class="o">(...))</span>
  <span class="o">.</span><span class="na">serviceUnder</span><span class="o">(</span><span class="s">&quot;/docs/&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">DocService</span><span class="o">());</span>
</pre></div>
</div>
<p>Note that we used <code class="docutils literal"><span class="pre">serviceUnder()</span></code> for <code class="docutils literal"><span class="pre">DocService</span></code> unlike the other services. <code class="docutils literal"><span class="pre">serviceUnder()</span></code> binds
a service to a directory recursively (prefix match) while <code class="docutils literal"><span class="pre">serviceAt()</span></code> binds to a specific path only
(exact-match.)</p>
<p>If you open <code class="docutils literal"><span class="pre">http://127.0.0.1:8080/docs/</span></code> in your browser, you will see the documentation pages produced by
the <code class="docutils literal"><span class="pre">DocService</span></code>. Here&#8217;s a sample, generated from the Cassandra Thrift IDL:</p>
<img alt="_images/docservice.png" src="_images/docservice.png" />
</div>
<div class="section" id="next-steps">
<h2>Next steps<a class="headerlink" href="#next-steps" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first"><a class="reference external" href="client-basics.html">Client basics</a> if you want to make a Thrift call to your Armeria server</p>
</li>
<li><p class="first"><a class="reference external" href="server-http-file.html">Serving static files</a> if you want to serve static files in your Armeria server</p>
</li>
<li><p class="first"><a class="reference external" href="server-http-tomcat.html">Embedding Apache Tomcat</a> if you want to run your JEE web application on the same port</p>
</li>
<li><dl class="first docutils">
<dt>or you could explore the server-side API documentation:</dt>
<dd><ul class="first last simple">
<li><a class="reference external" href="apidocs/index.html?com/linecorp/armeria/server/ServerBuilder.html">ServerBuilder</a></li>
<li><a class="reference external" href="apidocs/index.html?com/linecorp/armeria/server/Service.html">Service</a></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="server-http-file.html" class="btn btn-neutral float-right" title="Serving static files" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="server.html" class="btn btn-neutral" title="Writing a server" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, LINE Corporation.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  <div class="github-fork-ribbon-wrapper right">
  <div class="github-fork-ribbon">
    <a href="https://github.com/line/armeria">Fork me on GitHub</a>
  </div>
</div>
<!-- Append the Slack invitation at the end of the menu. -->
<script type="text/javascript">
var menus = document.getElementsByClassName("wy-menu wy-menu-vertical");
if (menus.length > 0) {
  var menu = menus[0];
  var lists = menu.getElementsByTagName('ul');
  if (lists.length > 0) {
    var li = document.createElement('li');
    li.className = 'toctree-l1';
    var div = document.createElement('div');
    div.className = 'slack-invitation';
    var script = document.createElement('script');
    script.type = 'text/javascript';
    script.src = 'https://slackin-line-armeria.herokuapp.com/slackin.js';
    div.appendChild(script);
    li.appendChild(div);
    lists[0].appendChild(li);
  }
}
</script>


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.21.2.Final',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>